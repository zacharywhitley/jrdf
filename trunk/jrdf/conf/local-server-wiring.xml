<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

    <bean id="org.restlet.data.MediaType.TEXT_HTML" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/>

    <bean id="configurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>classpath:org/jrdf/restlet/server/local/server.properties</value>
            </list>
        </property>
        <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE"/>
    </bean>

    <bean id="component" class="org.restlet.ext.spring.SpringComponent">
        <property name="server" ref="server"/>
        <property name="defaultTarget" ref="router"/>
        <property name="logService" ref="logService"/>
    </bean>

    <bean id="server" class="org.restlet.ext.spring.SpringServer">
        <constructor-arg value="http"/>
        <constructor-arg value="${server.port}"/>
    </bean>

    <bean id="logService" class="org.restlet.service.LogService">
        <constructor-arg index="0" value="false"/>
    </bean>

    <bean id="router" class="org.restlet.ext.spring.SpringRouter">
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="org.restlet.ext.spring.SpringFinder">
                        <lookup-method name="createResource" bean="graphs"/>
                    </bean>
                </entry>
                <entry key="/graphs">
                    <bean class="org.restlet.ext.spring.SpringFinder">
                        <lookup-method name="createResource" bean="graphs"/>
                    </bean>
                </entry>
                <entry key="/graphs/{graph}">
                    <bean class="org.restlet.ext.spring.SpringFinder">
                        <lookup-method name="createResource" bean="localGraphResource"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="graphs" class="org.jrdf.restlet.server.GraphsResource" scope="prototype">
        <property name="available" value="true"/>
        <property name="representationTemplates">
            <map>
                <entry key-ref="org.restlet.data.MediaType.TEXT_HTML" value-ref="graphsResourceHtml"/>
            </map>
        </property>
        <property name="graphApplication" ref="webApplication"/>
        <property name="freemarkerConfig" ref="freemarkerConfig"/>
    </bean>

    <bean id="graphsResourceHtml" class="org.jrdf.restlet.FreemarkerRepresentationFactory">
        <property name="templateName" value="graphsPage.ftl"/>
        <property name="freemarkerConfig" ref="freemarkerConfig"/>
    </bean>

    <bean id="graphsDoer" class="org.jrdf.restlet.server.GraphsResourceDoer" scope="prototype">
        <property name="graphApplication" ref="webApplication"/>
    </bean>

    <bean id="localGraphResource" class="org.jrdf.restlet.server.local.LocalGraphResource" scope="prototype">
        <property name="graphApplication" ref="webApplication"/>
    </bean>

    <bean id="webApplication" class="org.jrdf.restlet.server.local.WebInterfaceGraphApplication" scope="singleton"/>

    <bean id="freemarkerConfig" class="freemarker.template.Configuration">
        <property name="directoryForTemplateLoading" value="${user.dir}/resources"/>
        <property name="objectWrapper">
            <bean class="freemarker.template.DefaultObjectWrapper"/>
        </property>
    </bean>
</beans>