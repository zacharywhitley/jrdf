<?xml version="1.0" encoding="UTF-8"?>
<project name="jrdf-sparql" default="gen-sparql-parser" basedir=".">

    <import file="build-setup.xml"/>

    <path id="sablecc.class.path">
        <pathelement location="${lib.dir}/sablecc-2.18.2.jar"/>
    </path>

    <macrodef name="sablecc.macro">
        <attribute name="grammar.file"/>
        <sequential>
            <taskdef name="sablecc" classname="org.sablecc.ant.taskdef.Sablecc" classpathref="sablecc.class.path"/>
            <mkdir dir="${gen.src.dir}"/>
            <sablecc src="${sablecc.src.dir}" outputdirectory="${gen.src.dir}">
                <include name="@{grammar.file}"/>
            </sablecc>
        </sequential>
    </macrodef>

    <target name="gen-sparql-parser" depends="-sparql-parser-uptodate" unless="sparql-parser-uptodate">
        <sablecc.macro grammar.file="sparql.grammar"/>
    </target>
    <target name="-sparql-parser-uptodate">
        <uptodate property="sparql-parser-uptodate"
                  targetfile="${gen.src.dir}/org/jrdf/sparql/parser/analyser/DepthFirstAdapter.java">
            <srcfiles dir="${sablecc.src.dir}" includes="sparql.grammar"/>
        </uptodate>
    </target>

    <!-- FIXME TJA: Is there a better way to do this? Maybe specify in the classpath? -->
    <target name="-copy-sablecc-resources">
        <copy file="${gen.src.dir}/org/jrdf/sparql/parser/lexer/lexer.dat"
                tofile="${prod.classes.dir}/org/jrdf/sparql/parser/lexer/lexer.dat"/>
        <copy file="${gen.src.dir}/org/jrdf/sparql/parser/parser/parser.dat"
                tofile="${prod.classes.dir}/org/jrdf/sparql/parser/parser/parser.dat"/>
    </target>

</project>
